<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dos Meninas 2</title>
  <link href="reset.css" rel="stylesheet">
  <style>
  </style>
</head>

<body>

<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> -->
<!-- <script src='jquery/jquery-1.9.1.js'></script> -->
<script src='jquery/jquery.min.js'></script>
<script src='thing.js'></script>
<script src='sylvester/sylvester.js'></script>
<script src='dos_meninas.js'></script>

<script type="text/javascript">

function makePattern (name, size) {
  var Rand = Thing.classes.Rand;
  var Pattern = Thing.classes[name] ? Thing.classes[name] : Thing.classes.Pattern;
  var P =  Pattern.make({pattern: name, size: size});
  var box = Thing.classes.Box.make( {
    x: Rand.randInt(0,1000),
    y: 0,
    w: Rand.randInt(200,1600),
    h: 2000,
    z: Rand.randInt(1,1000) * 10,
    backgroundColor: 'transparent',   //Rand.randItem(greens),
    position: 'absolute',
    display: 'block',
    overflow: 'hidden'
  });

  box.add( P )
  return box;
}

function makeMeninaSandwich(props) {
  var Rand = Thing.classes.Rand;
  var Img = Thing.classes.Img;

  var mWich = Thing.classes.Box.make({
    x: props.x,
    y: 1030,
    w: 1300,
    h: 1770,
    zIndex: 10000
  });

  var solidMenina = Img.make({
    src:'img/las_meninas_girl_mask.png',
    w: 1300,
    h: 1770,
    filter: 'drop-shadow(10px 10px 20px rgba(0,0,0,0.7))'
  }).scaleTo(1.01);

  var meninaPatterns = Thing.classes.Box.make({
    width: '100%',
    height: '100%',
    backgroundColor: Rand.randItem(greens),
    WebkitMaskImage: 'url(img/las_meninas_girl_mask.png)',   // 846 X 1150     .735
    WebkitMaskRepeat: 'no-repeat',
    WebkitMaskSize: '100%',
    opacity: .85
  });

  mWich.add(solidMenina);

  meninaPatterns.add(makeTextPane(0, 0, Rand.randInt(100,650), 2000));
  meninaPatterns.add(makePattern('GraphPaper'));
  meninaPatterns.add(makePattern('PlaidRedLarge'));
  meninaPatterns.add(makePattern('Sofa', Rand.randItem(sofaSizes)));
  meninaPatterns.add(makePattern('PatternPolkaDots', Rand.randInt(10,250)));
  meninaPatterns.add(makePattern('PatternStripes', Rand.randInt(50,300)));
  meninaPatterns.add(makePattern('DiagonalStripesViolet', Rand.randInt(3,20)));
  mWich.add(meninaPatterns);

  return mWich;
}

$(function () {
  var Rand = Thing.classes.Rand;
  var Img = Thing.classes.Img;
  var TextPane = Thing.classes.TextPane;

  // setup the stage
  var aspectRatio = .72;
  var pixelWidth = 5000;
  var pixelHeight = pixelWidth * aspectRatio;
  var mainScale = pixelWidth * .001;  // assume design is 1000 pixels wide, this will be 1
  var background = makeBackground(pixelWidth, pixelHeight, mainScale).css({backgroundColor:'#ffe78b'});

  var menina = Img.make({
    src:'img/las_meninas_girl_t.png',
    x: 1100,
    y: 1700,
    zIndex: 40000
  }).scaleTo(1.8);

  var rightWall = Img.make({
      src: 'img/vintagewallpaper4_crop.png',
      w: 2000,
      h: 2000,
      z: 2000,
      opacity: .05
    })
    .css({
      transform: 'translate(2500px, 200px) rotateY(100deg) scale(2.2)'
    });

  var lightSpot = Thing.make({
      w: 4150,
      h: 2800,
      background: 'radial-gradient(at 40% 30%, rgba(250, 239, 200, 0.89) 10%, transparent 50%, rgba(124, 72, 82, 0.54) 90%)'
    });

  var backWall = Thing.classes.Box.make({
    w: 4150,
    h: 2800,
    overflow: 'hidden'
  });

  var wallpaper =  Thing.classes.PatternStripes.make({color: 'rgba(196, 191, 138, 0.52)', size: 200});

  // Room edge right side
  var edge = Thing.classes.Line.make({
    x1:4150, y1:0,
    x2:4150, y2:3000,
    width: 20,
    zIndex: 10010,
    background: 'linear-gradient(rgb(0, 40, 80) 0%, rgb(255, 128, 0) 100%)'
  });

  // makeFloor
  var floorImg = Thing.classes.Img
    .make({
      src:'img/wood_texture_smooth_panel_red_oak_pers_left.png',
      right: '0px',
      bottom: '0px',
      w: pixelWidth,
      h: 800,
      zIndex: 20000
    });

  var meninaSandwich1 = makeMeninaSandwich({x: -200});
  var meninaSandwich2 = makeMeninaSandwich({x: 1100});
  var meninaSandwich3 = makeMeninaSandwich({x: 2400});
  var meninaSandwich4 = makeMeninaSandwich({x: 3700});

  var codeLabel = Thing.classes.Label.make({
    text: 'waiting...',
    x: 2400,
    y: 200,
    w: 1300,
    h: 1500,
    fontSize: '80px',
    color: '#0c3',
    textShadow: '1px 1px 3px rgba(0,0,0,0.2)',
    whiteSpace: 'pre'
  });

  var pos = menina.getPosition();

  // called after images load (renders Background)
  function makeImgPointers () {
    var dim = menina.getDimensions();
    var point = [500, 100];
    var M = makeMatrix2D( menina.getCSSTransform() );
    var tp = transformPoint (point, M, [dim.w/2, dim.h/2]);

    // point to Menina
    var pointer = makeTextArrow(
      Rand.randInt(tp[0]-100, tp[0]+100), Rand.randInt(tp[1]-150, tp[1]-350),
      tp[0], tp[1],
      '#5dff1d', parseInt(tp[0]), 60, pos[2]+5000);
    pointer[1].css({fontSize:'200px', fontWeight: 'bold'});

    background.add(pointer);
    background.render();

    // update the code text AFTER render
    codeLabel.setText( JSON.stringify(meninaSandwich4.props, null, 4) );
  }
  Img.onAllLoaded = makeImgPointers;

  window.BG = background;

  // Prevents the screenshot plugin from including scrollbars in large screenshots.
  $('body').css({
    overflow: 'hidden',
    transformOrigin: '0 0',
    transform: 'scale(1)'  // .8 TEMPORARILY for testing on laptop sized screen
  });

  backWall.add(lightSpot);
  backWall.add(meninaSandwich1);
  backWall.add(meninaSandwich2);
  backWall.add(meninaSandwich3);
  backWall.add(meninaSandwich4);
  backWall.add(codeLabel);

  background.add(wallpaper);
  background.add(backWall);
  background.add(menina);
  background.add(rightWall);
  background.add(edge);
  background.add( makeBubbleArrow(
          Rand.randInt(100,3000), Rand.randInt(100,500),
          menina.x, menina.y,
          '#ceff34', '', false, Rand.randInt(3000,15000)) );
  background.add(floorImg);

  background.render();

  // mask image:
  // -webkit-mask-image: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/234228/alpha-cat.png);
  //
  // -webkit-mask-image: url(file:///Users/mark.napier/Projects/htdocs/Thing/img/las_meninas_girl_t.png);
  // -webkit-mask-repeat: no-repeat;
  // -webkit-mask-size: 140%;
  // opacity: .85;
});
</script>


</body>
</html>
